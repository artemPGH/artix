<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ARTIX ‚Äî –ø–æ–º–æ—â–Ω–∏–∫</title>
    <style>
        * { box-sizing: border-box; }

        body {
            background: radial-gradient(circle at top, #050716, #020308 60%, #000000);
            color: #f5f5f5;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 16px;
        }

        .app {
            width: 100%;
            max-width: 760px;
            background: rgba(8, 10, 26, 0.96);
            border-radius: 20px;
            padding: 22px 22px 16px;
            box-shadow:
                0 0 40px rgba(0, 0, 0, 0.8),
                0 0 80px rgba(88, 166, 255, 0.18);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 12px;
            gap: 12px;
        }

        .title {
            font-size: 26px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 12px;
            opacity: 0.7;
        }

        .mode-switch {
            display: inline-flex;
            padding: 3px;
            border-radius: 999px;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(148,163,184,0.4);
        }

        .mode-btn {
            border: none;
            background: transparent;
            color: #cbd5f5;
            font-size: 11px;
            padding: 6px 12px;
            border-radius: 999px;
            cursor: pointer;
            opacity: 0.85;
        }

        .mode-btn.active {
            background: radial-gradient(circle at top, #4f46e5, #312e81);
            color: #f9fafb;
            opacity: 1;
            box-shadow: 0 0 12px rgba(129, 140, 248, 0.6);
        }

        .chat {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 12px;
            padding: 10px 10px;
            height: 290px;
            overflow-y: auto;
            font-size: 14px;
            margin-bottom: 12px;
            border: 1px solid rgba(30,64,175,0.5);
        }

        .msg {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .msg-user {
            text-align: right;
        }

        .msg-user span {
            background: linear-gradient(135deg, rgba(59,130,246,0.35), rgba(8,47,73,0.9));
            padding: 7px 11px;
            border-radius: 12px;
            display: inline-block;
            max-width: 85%;
        }

        .msg-bot span {
            background: linear-gradient(135deg, rgba(16,185,129,0.24), rgba(15,23,42,0.95));
            padding: 7px 11px;
            border-radius: 12px;
            display: inline-block;
            max-width: 100%;
        }

        .msg-bot code {
            font-family: "JetBrains Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 12px;
        }

        pre {
            margin: 6px 0 2px;
            padding: 8px 10px;
            border-radius: 10px;
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(55,65,81,0.8);
            overflow-x: auto;
        }

        .input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        input[type="text"] {
            flex: 1;
            padding: 9px 11px;
            border-radius: 10px;
            border: 1px solid rgba(148,163,184,0.7);
            background: rgba(15,23,42,0.95);
            color: #e5e7eb;
            outline: none;
            font-size: 14px;
        }

        input[type="text"]::placeholder {
            color: rgba(148,163,184,0.7);
        }

        button.send-btn {
            padding: 9px 14px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, #4f46e5, #06b6d4);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
            font-size: 14px;
            white-space: nowrap;
        }

        button.send-btn:hover {
            box-shadow: 0 0 14px rgba(59,130,246,0.75);
            transform: translateY(-1px);
        }

        button.send-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .footer {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        .hint-label {
            opacity: 0.85;
        }

        .hints {
            opacity: 0.8;
        }

        .hints span {
            background: rgba(15,23,42,0.95);
            border-radius: 999px;
            padding: 3px 8px;
            border: 1px solid rgba(148,163,184,0.6);
            margin-right: 4px;
            margin-bottom: 2px;
            display: inline-block;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            .app {
                padding: 14px 12px 12px;
            }
            .chat {
                height: 260px;
            }
            .title {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
<div class="app">
    <div class="header">
        <div>
            <div class="title">ARTIX</div>
            <div class="subtitle">–ø–æ–º–æ—â–Ω–∏–∫ —Å —Ä–µ–∂–∏–º–∞–º–∏: –æ–±—ã—á–Ω—ã–π –∏ Python</div>
        </div>
        <div class="mode-switch">
            <button class="mode-btn active" data-mode="general">–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º</button>
            <button class="mode-btn" data-mode="python">Python —Ä–µ–∂–∏–º</button>
        </div>
    </div>

    <div id="chat" class="chat"></div>

    <div class="input-row">
        <input
            id="userInput"
            type="text"
            placeholder="–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä: —á—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è?"
        >
        <button id="sendBtn" class="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <div class="footer">
        <div>
            <span class="hint-label">–†–µ–∂–∏–º—ã:</span>
            <span>–æ–±—ã—á–Ω—ã–π ‚Äî –±–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã,</span>
            <span>Python ‚Äî –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏ –ø–æ–∏—Å–∫ –ø–æ StackOverflow.</span>
        </div>
        <div class="hints" id="hints">
            <span>—á—Ç–æ —Ç–∞–∫–æ–µ python</span>
            <span>–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ü–∏–∫–ª for –≤ python</span>
        </div>
    </div>
</div>

<script>
    // =========================
    // 1. –£—Ç–∏–ª–∏—Ç—ã
    // =========================

    function tokenize(text) {
        return text
            .toLowerCase()
            .split(/[^a-zA-Z–∞-—è–ê-–Ø0-9_]+/u)
            .filter(Boolean);
    }

    function similarityScore(question, item) {
        const qTokens = new Set(tokenize(question));
        const itemText = (item.q + " " + (item.tags || []).join(" ")).toLowerCase();
        const itemTokens = new Set(tokenize(itemText));

        if (!qTokens.size || !itemTokens.size) return 0;

        let inter = 0;
        qTokens.forEach(t => {
            if (itemTokens.has(t)) inter++;
        });

        return inter / Math.max(qTokens.size, itemTokens.size);
    }

    function findBestMatch(question, knowledgeBase) {
        let best = null;
        let bestScore = 0;

        for (const item of knowledgeBase) {
            const score = similarityScore(question, item);
            if (score > bestScore) {
                bestScore = score;
                best = item;
            }
        }

        return { item: best, score: bestScore };
    }

    function escapeHtml(str) {
        return str.replace(/[&<>"']/g, function (c) {
            return ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                "\"": "&quot;",
                "'": "&#39;"
            })[c];
        });
    }

    function normalizeQuestion(text) {
        return tokenize(text).join(" ");
    }

    // =========================
    // 2. –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    // =========================

    const generalKnowledge = [
        {
            q: "—á—Ç–æ —Ç–∞–∫–æ–µ artix",
            tags: ["artix", "–∫—Ç–æ —Ç—ã", "–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç"],
            answer: "ARTIX ‚Äî –ø—Ä–æ—Å—Ç–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –∏ –æ–±—É—á–∞—é—â–∞—è —Å—Ä–µ–¥–∞. –û–Ω –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –±–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –Ω–∞ Python."
        },
        {
            q: "–∫—Ç–æ —Ç–µ–±—è —Å–æ–∑–¥–∞–ª",
            tags: ["—Å–æ–∑–¥–∞—Ç–µ–ª—å", "–∞–≤—Ç–æ—Ä", "–∞—Ä—Ç–µ–º"],
            answer: "–ú–µ–Ω—è —Å–æ–∑–¥–∞–ª –ê—Ä—Ç—ë–º. –≠—Ç–æ—Ç —Å–∞–π—Ç –∏ –ª–æ–≥–∏–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ."
        },
        {
            q: "—á—Ç–æ —Ç–∞–∫–æ–µ python",
            tags: ["python", "–ø–∏—Ç–æ–Ω", "—è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è"],
            answer: "Python ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è. –ï–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –º–Ω–æ–≥–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ."
        },
        {
            q: "—á—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è",
            tags: ["–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è"],
            answer: "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è ‚Äî —ç—Ç–æ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–Ω–∞—á–µ–Ω–∏—è. –í –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∞—é—Ç –∏–º—è –∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –∫–æ–¥–µ."
        },
        {
            q: "—á—Ç–æ —Ç–∞–∫–æ–µ –∞–ª–≥–æ—Ä–∏—Ç–º",
            tags: ["–∞–ª–≥–æ—Ä–∏—Ç–º", "—à–∞–≥–∏", "–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"],
            answer: "–ê–ª–≥–æ—Ä–∏—Ç–º ‚Äî —ç—Ç–æ —á—ë—Ç–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç."
        }
    ];

    const pythonKnowledge = [
        {
            q: "–≤—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω",
            tags: ["print", "–≤—ã–≤–æ–¥", "—Ç–µ–∫—Å—Ç"],
            answer: `
–ß—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω –≤ Python, –∏—Å–ø–æ–ª—å–∑—É–π —Ñ—É–Ω–∫—Ü–∏—é <code>print</code>:

<pre><code>print("–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!")</code></pre>

–ú–æ–∂–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π:

<pre><code>name = "–ê—Ä—Ç—ë–º"
age = 15
print("–ú–µ–Ω—è –∑–æ–≤—É—Ç", name, "–∏ –º–Ω–µ", age, "–ª–µ—Ç")</code></pre>
            `
        },
        {
            q: "—Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é",
            tags: ["–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è", "variable", "–ø—Ä–∏—Å–≤–æ–∏—Ç—å"],
            answer: `
–í Python –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–∏:

<pre><code>age = 15
name = "–ê—Ä—Ç—ë–º"
pi = 3.14
is_active = True</code></pre>

–¢–∏–ø –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é.
            `
        },
        {
            q: "—É—Å–ª–æ–≤–∏–µ if",
            tags: ["if", "else", "—É—Å–ª–æ–≤–∏–µ"],
            answer: `
–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ —É—Å–ª–æ–≤–∏—è –≤ Python:

<pre><code>x = 10

if x &gt; 5:
    print("x –±–æ–ª—å—à–µ 5")
elif x == 5:
    print("x —Ä–∞–≤–Ω–æ 5")
else:
    print("x –º–µ–Ω—å—à–µ 5")</code></pre>
            `
        },
        {
            q: "—Ü–∏–∫–ª for",
            tags: ["for", "—Ü–∏–∫–ª", "range"],
            answer: `
–ü—Ä–∏–º–µ—Ä —Ü–∏–∫–ª–∞ <code>for</code> —Å <code>range</code>:

<pre><code>for i in range(5):
    print("–ò—Ç–µ—Ä–∞—Ü–∏—è:", i)</code></pre>

–ü–µ—Ä–µ–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞:

<pre><code>numbers = [10, 20, 30]
for n in numbers:
    print(n)</code></pre>
            `
        },
        {
            q: "—Ñ—É–Ω–∫—Ü–∏—è def",
            tags: ["def", "—Ñ—É–Ω–∫—Ü–∏—è", "return"],
            answer: `
–û–±—ä—è–≤–ª–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

<pre><code>def greet(name):
    print("–ü—Ä–∏–≤–µ—Ç,", name)

greet("–ê—Ä—Ç—ë–º")</code></pre>
            `
        }
    ];

    // =========================
    // 3. –ö—ç—à –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–æ–±—É—á–µ–Ω–∏–µ)
    // =========================

    const WEB_CACHE_KEY = "artix_web_cache_v1";

    function loadWebCache() {
        try {
            const raw = localStorage.getItem(WEB_CACHE_KEY);
            if (!raw) return {};
            const data = JSON.parse(raw);
            return typeof data === "object" && data !== null ? data : {};
        } catch (e) {
            return {};
        }
    }

    let webCache = loadWebCache();

    function saveWebCache() {
        try {
            localStorage.setItem(WEB_CACHE_KEY, JSON.stringify(webCache));
        } catch (e) {
            // ignore
        }
    }

    function renderWebResultHTML(result) {
        if (!result) return "–Ø –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à—ë–ª.";

        if (result.source === "wikipedia") {
            const title = escapeHtml(result.title || "");
            const snippet = escapeHtml(result.snippet || "");
            const url = result.url || "#";
            return `
–ù–∞—à—ë–ª –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏: <b>${title}</b><br>
<span>${snippet}</span><br>
<a href="${url}" target="_blank" rel="noopener noreferrer">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç—å—é</a>
            `;
        }

        if (result.source === "stackoverflow") {
            const title = escapeHtml(result.title || "");
            const url = result.url || "#";
            return `
–ù–∞—à—ë–ª –≤–æ–ø—Ä–æ—Å –Ω–∞ StackOverflow –ø–æ Python:<br>
<b>${title}</b><br>
<a href="${url}" target="_blank" rel="noopener noreferrer">–û—Ç–∫—Ä—ã—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ</a>
            `;
        }

        return escapeHtml(result.text || "–Ø –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à—ë–ª.");
    }

    // =========================
    // 4. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–∏—Å–∫ (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ API)
    // =========================

    // 4.1. –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º ‚Äî Wikipedia (ru)
    async function fetchFromWikipedia(question) {
        const searchUrl =
            "https://ru.wikipedia.org/w/api.php" +
            "?action=opensearch" +
            "&limit=1" +
            "&namespace=0" +
            "&format=json" +
            "&origin=*" +
            "&search=" + encodeURIComponent(question);

        const res = await fetch(searchUrl);
        if (!res.ok) return null;
        const data = await res.json();

        const title = data[1] && data[1][0];
        const desc = data[2] && data[2][0];
        const url  = data[3] && data[3][0];

        if (!title || !url) return null;

        return {
            source: "wikipedia",
            title,
            snippet: desc || "",
            url
        };
    }

    // 4.2. Python-—Ä–µ–∂–∏–º ‚Äî StackOverflow (–±–µ–∑ –∫–ª—é—á–∞, –º–∞–ª–µ–Ω—å–∫–∞—è –∫–≤–æ—Ç–∞)
    async function fetchFromStackOverflowPython(question) {
        const apiUrl =
            "https://api.stackexchange.com/2.3/search/advanced" +
            "?order=desc&sort=relevance" +
            "&answers=1" +
            "&tagged=python" +
            "&site=stackoverflow" +
            "&pagesize=1" +
            "&q=" + encodeURIComponent(question);

        const res = await fetch(apiUrl);
        if (!res.ok) return null;

        const data = await res.json();
        if (!data.items || !data.items.length) return null;

        const item = data.items[0];
        return {
            source: "stackoverflow",
            title: item.title,
            url: item.link
        };
    }

    // =========================
    // 5. –ß–∞—Ç –∏ —Ä–µ–∂–∏–º—ã
    // =========================

    const chatEl = document.getElementById("chat");
    const inputEl = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const modeButtons = document.querySelectorAll(".mode-btn");
    const hintsEl = document.getElementById("hints");

    let currentMode = "general";

    function setMode(mode) {
        currentMode = mode;

        modeButtons.forEach(btn => {
            btn.classList.toggle("active", btn.dataset.mode === mode);
        });

        if (mode === "general") {
            inputEl.placeholder = "–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä: —á—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è?";
            hintsEl.innerHTML = `
                <span>—á—Ç–æ —Ç–∞–∫–æ–µ artix</span>
                <span>—á—Ç–æ —Ç–∞–∫–æ–µ python</span>
                <span>—á—Ç–æ —Ç–∞–∫–æ–µ –∞–ª–≥–æ—Ä–∏—Ç–º</span>
            `;
            addMessage("–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º: –º–æ–∂–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –≤–µ—â–∏. –ï—Å–ª–∏ —è —Å–∞–º –Ω–µ –∑–Ω–∞—é ‚Äî –ø–æ–ø—Ä–æ–±—É—é –Ω–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏.", "bot");
        } else {
            inputEl.placeholder = "–°–ø—Ä–æ—Å–∏ –ø—Ä–æ –∫–æ–¥ –Ω–∞ Python, –Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ü–∏–∫–ª for –≤ python";
            hintsEl.innerHTML = `
                <span>–∫–∞–∫ –≤—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω</span>
                <span>–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ü–∏–∫–ª for –≤ python</span>
                <span>–ø—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –≤ python</span>
            `;
            addMessage("Python —Ä–µ–∂–∏–º: —Å–Ω–∞—á–∞–ª–∞ –∏—â—É –≤ —Å–≤–æ–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç ‚Äî –ø–æ–ø—Ä–æ–±—É—é –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–æ–ø—Ä–æ—Å –Ω–∞ StackOverflow.", "bot");
        }
    }

    modeButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            if (btn.dataset.mode !== currentMode) {
                setMode(btn.dataset.mode);
            }
        });
    });

    hintsEl.addEventListener("click", (e) => {
        if (e.target.tagName === "SPAN") {
            inputEl.value = e.target.textContent;
            inputEl.focus();
        }
    });

    function addMessage(text, from, isHtml = false) {
        const div = document.createElement("div");
        div.className = "msg " + (from === "user" ? "msg-user" : "msg-bot");

        const span = document.createElement("span");
        if (isHtml) {
            span.innerHTML = text;
        } else {
            span.textContent = text;
        }

        div.appendChild(span);
        chatEl.appendChild(div);
        chatEl.scrollTop = chatEl.scrollHeight;
    }

    function basicGreetingReply(question) {
        const q = question.toLowerCase();
        if (q.includes("–ø—Ä–∏–≤–µ—Ç") || q.includes("–∑–¥—Ä–∞–≤—Å—Ç–≤")) {
            return "–ü—Ä–∏–≤–µ—Ç! –Ø ARTIX. –í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º ‚Äî –æ–±—ã—á–Ω—ã–π –∏–ª–∏ Python ‚Äî –∏ –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã.";
        }
        if (q.includes("—Å–ø–∞—Å–∏–±–æ")) {
            return "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞!";
        }
        if (q.includes("–∫–∞–∫ –¥–µ–ª–∞")) {
            return "–†–∞–±–æ—Ç–∞—é –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞–ø—Ä–æ—Å—ã üôÇ";
        }
        return null;
    }

    function pickLocalAnswer(question) {
        const greet = basicGreetingReply(question);
        if (greet) return { answer: greet, isHtml: false, found: true };

        const kb = currentMode === "python" ? pythonKnowledge : generalKnowledge;
        const { item, score } = findBestMatch(question, kb);

        if (item && score >= 0.28) {
            return { answer: item.answer, isHtml: true, found: true };
        }

        return { answer: null, isHtml: false, found: false };
    }

    async function handleSend() {
        const text = inputEl.value.trim();
        if (!text) return;

        addMessage(text, "user");
        inputEl.value = "";

        // 1. –ü—Ä–æ–±—É–µ–º –æ—Ç–≤–µ—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
        const local = pickLocalAnswer(text);
        if (local.found) {
            addMessage(local.answer, "bot", local.isHtml);
            return;
        }

        // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à ‚Äú–∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞‚Äù
        const norm = normalizeQuestion(text);
        if (webCache[norm]) {
            const html = renderWebResultHTML(webCache[norm]);
            addMessage(html, "bot", true);
            return;
        }

        // 3. –ì–æ–≤–æ—Ä–∏–º, —á—Ç–æ –∏–¥—ë–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
        addMessage("–Ø —ç—Ç–æ–≥–æ –Ω–µ –∑–Ω–∞—é. –ü–æ–ø—Ä–æ–±—É—é –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ...", "bot");

        try {
            let result = null;
            if (currentMode === "python") {
                result = await fetchFromStackOverflowPython(text);
            } else {
                result = await fetchFromWikipedia(text);
            }

            if (result) {
                webCache[norm] = result;
                saveWebCache();

                const html = renderWebResultHTML(result);
                addMessage(html, "bot", true);
            } else {
                addMessage("–Ø –Ω–∏—á–µ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–≥–æ –Ω–µ –Ω–∞—à—ë–ª. –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å.", "bot");
            }
        } catch (e) {
            addMessage("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–∞–π—Ç—É. –í–æ–∑–º–æ–∂–Ω–æ, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é.", "bot");
        }
    }

    sendBtn.addEventListener("click", () => { handleSend(); });
    inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") handleSend();
    });

    // —Å—Ç–∞—Ä—Ç
    addMessage("–ü—Ä–∏–≤–µ—Ç! –Ø ARTIX. –í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ –æ—Ç–≤–µ—á–∞—é –Ω–∞ –±–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞—â–∞—é—Å—å –∫ –í–∏–∫–∏–ø–µ–¥–∏–∏. –í Python —Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞—é –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏ –º–æ–≥—É –∏—Å–∫–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ StackOverflow.", "bot");
</script>
</body>
</html>
